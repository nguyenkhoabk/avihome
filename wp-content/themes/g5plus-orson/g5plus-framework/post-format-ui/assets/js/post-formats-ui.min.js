(function(b){var c=c||{},a=["audio","gallery","link","quote","video"];c.onReady={init:function(){c.postFormats.init();c.media.init()}};c.postFormats={init:function(){c.postFormats.switchTab();c.postFormats.renderUI();},switchTab:function(){b("#g5plus-post-formats-ui-tabs a").live("click",function(d){d.preventDefault();var e=b(this),g=e.attr("href").replace("#",""),f=b("#g5plus-pfui-"+g);if(e.hasClass("current")){return}b('#g5plus-post-formats-ui-tabs a[class="current"]').removeClass("current");e.addClass("current");b('[id^="g5plus-pfui-post-format-"]').hide();f.show();b("#"+g).trigger("click")})},renderUI:function(){b("#g5plus-post-formats-ui-tabs").insertBefore(b("form#post")).show();b("#g5plus-pfui-post-format-link, #g5plus-pfui-post-format-video, #g5plus-pfui-post-format-audio").insertAfter(b("#titlediv"));b("#g5plus-pfui-post-format-gallery").find("dt a").each(function(){b(this).replaceWith(b(this.childNodes))}).end().insertAfter(b("#titlediv"));b("#g5plus-pfui-post-format-quote").insertAfter(b("#titlediv"));b(document).trigger("g5plus-post-formats-ui-init");var d=b('#g5plus-post-formats-ui-tabs a[class="current"]').attr("href").replace("#","");b("#g5plus-pfui-"+d).show()}};c.media={_frame:null,init:function(){b("#wpbody").on("click",".g5plus-pfui-gallery-button",function(d){d.preventDefault();c.media.frame().open()});this.event()},event:function(){var d=b(".g5plus-pfui-gallery-picker .gallery");d.on("update",function(){var e=[];b(this).find("> span").each(function(){e.push(b(this).data("id"))});b('[name="g5plus_format_gallery_images"]').val(e.join(","))});d.sortable({placeholder:"g5plus-pfui-ui-state-highlight",revert:200,tolerance:"pointer",stop:function(){d.trigger("update")}});d.on("click","span.close",function(f){b(this).parent().fadeOut(200,function(){b(this).remove();d.trigger("update")})})},frame:function(){if(this._frame){return this._frame}this._frame=wp.media({title:g5plus_pfui_post_format.media_title,library:{type:"image"},button:{text:g5plus_pfui_post_format.media_button},multiple:true});this._frame.on("open",this.updateFrame).state("library").on("select",this.select);return this._frame},select:function(){var e=this.get("selection"),d=b(".g5plus-pfui-gallery-picker .gallery");e.each(function(f){var g=f.attributes.url;if(f.attributes.sizes!==undefined&&f.attributes.sizes.thumbnail!==undefined){g=f.attributes.sizes.thumbnail.url}d.append('<span data-id="'+f.id+'" title="'+f.attributes.title+'"><img src="'+g+'" alt="" /><span class="close">x</span></span>');d.trigger("update")})},updateFrame:function(){},};b(document).ready(c.onReady.init)})(jQuery);